<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ReflexAI Admin Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background: #181818; color: #fff; display: flex; align-items: center; justify-content: center; height: 100vh; }
    .admin-box { background: #232323; border-radius: 10px; padding: 36px 28px; min-width: 340px; max-width: 95vw; }
    .admin-box h2 { margin-bottom: 18px; }
    .admin-box form { display: flex; flex-direction: column; gap: 12px; }
    .admin-box input, button { padding: 10px; border-radius: 5px; border: none; }
    .admin-box input { background: #181818; border: 1px solid #444; color: #fff; }
    .admin-box button { background: #E58320; color: #fff; font-weight: bold; cursor: pointer; }
    .feedback { color: #f55; font-size: 13px; margin-top: 8px; }
    .admin-console { display: none; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="admin-box">
    <h2>ReflexAI Admin</h2>
    <form id="adminLoginForm" autocomplete="off">
      <input type="password" name="adminpass" placeholder="Пароль администратора" required>
      <button type="submit">Войти</button>
    </form>
    <div class="feedback" id="adminFeedback"></div>

    <div class="admin-console" id="adminConsole">
      <h3>Ожидающие регистрации</h3>
      <ul id="pendingList" style="list-style:none;padding:0;"></ul>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById('adminLoginForm');
    const feedback = document.getElementById('adminFeedback');
    const adminConsole = document.getElementById('adminConsole');
    const pendingList = document.getElementById('pendingList');
    let adminToken = null;

    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      const pass = loginForm.adminpass.value;
      try {
        const res = await fetch('/api/admin/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: pass })
        });
        if (!res.ok) throw new Error();
        const data = await res.json();
        adminToken = data.token;
        loginForm.style.display = 'none';
        feedback.textContent = '';
        adminConsole.style.display = 'block';
        loadPending();
      } catch {
        feedback.textContent = 'Неверный пароль';
      }
    };

    async function loadPending() {
      pendingList.innerHTML = '<li>Загрузка...</li>';
      try {
        const res = await fetch('/api/admin/pending', {
          headers: { 'Authorization': `Bearer ${adminToken}` }
        });
        const data = await res.json();
        pendingList.innerHTML = '';
        data.forEach(user => {
          const li = document.createElement('li');
          li.textContent = `${user.username} (${user.displayName})`;
          pendingList.appendChild(li);
        });
      } catch {
        pendingList.innerHTML = '<li>Ошибка загрузки</li>';
      }
    }
  </script>
</body>
</html>
